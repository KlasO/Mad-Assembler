mads 2.1.7 build 34 (13 Sep 24)
Source: D:\!Delphi\mads\examples\pokeymax\detect.asm
     1 = 009B			EOL = $9B
     2
     3 = D200			POKEYMAX_BASE = $D200
     4
     5 = D210			POKEYMAX_CONFIG_BASE = $D210
     6
     7 = D240			POKEYMAX_SID_BASE = $D240
     8
     9 = 0000			POKEYMAX_MODE = $00
    10 = 0000			POKEYMAX_SATURATE_LINEAR = %00000000
    11 = 0001			POKEYMAX_SATURATE_POKEY = %00000001
    12 = 0000			POKEYMAX_SEPARATE_CHIP = %00000000
    13 = 0004			POKEYMAX_SEPARATE_CHANNEL = %00000100
    14 = 0000			POKEYMAX_IRQ_ONE = %00000000
    15 = 0008			POKEYMAX_IRQ_ALL = %00001000
    16 = 0000			POKEYMAX_MONO_FIXED = %00000000
    17 = 0010			POKEYMAX_MONO_DETECTION = %00010000
    18 = 0000			POKEYMAX_CLOCK_NTSC = %00000000
    19 = 0020			POKEYMAX_CLOCK_PAL = %00100000
    20 = 0020			POKEYMAX_CLOCK_MASK = %00100000
    21
    22 = 0001			POKEYMAX_CAPABILITY = $01
    23 = 0000			POKEYMAX_POKEY_SINGLE = %00000000
    24 = 0001			POKEYMAX_POKEY_STEREO = %00000001
    25 = 0002			POKEYMAX_POKEY_QUAD = %00000010
    26 = 0004			POKEYMAX_SID_PRESENT = %00000100
    27 = 0008			POKEYMAX_PSG_PRESENT = %00001000
    28 = 0010			POKEYMAX_COVOX_PRESENT = %00010000
    29 = 0020			POKEYMAX_SAMPLE_PRESENT = %00100000
    30 = 0040			POKEYMAX_FLASH_PRESENT = %01000000
    31
    32 = 0002			POKEYMAX_POSTDIVIDE = $02
    33 = 0000			POKEYMAX_DIV1 = %00000000
    34 = 0001			POKEYMAX_DIV2 = %00000001
    35 = 0002			POKEYMAX_DIV4 = %00000010
    36 = 0003			POKEYMAX_DIV8 = %00000011
    37 = 0000			POKEYMAX_DIVCH0 = 0
    38 = 0002			POKEYMAX_DIVCH1 = 2
    39 = 0004			POKEYMAX_DIVCH2 = 4
    40 = 0006			POKEYMAX_DIVCH3 = 6
    41
    42 = 0003			POKEYMAX_GTIAEN = $03
    43 = 0001			POKEYMAX_GTIA0 = %00000001
    44 = 0002			POKEYMAX_GTIA1 = %00000010
    45 = 0004			POKEYMAX_GTIA2 = %00000100
    46 = 0008			POKEYMAX_GTIA3 = %00001000
    47
    48 = 0004			POKEYMAX_VERSIONLOC = $04
    49 = 0004			POKEYMAX_VERSION = $04
    50 				; VRRDDDXX
    51 				; ::::::++-- chip configuration
    52 				; :::+++---- device signature
    53 				; :++------- firmware revision
    54 				; +--------- firmware version
    55 				; 105M02SA - stereo with auto control + GTIA in
    56 				; 105M02SU - stereo with Ultimate1MB control + GTIA in
    57 				; 105M02SC - stereo with COVOX + GTIA in
    58 				; 105M04QA - quad with auto control + GTIA in
    59 				; 105M04QC - quad with COVOX
    60
    61 = 0005			POKEYMAX_PSGMODE = $05
    62 = 0000			POKEYMAX_PSGFREQ_2MHZ = %00000000
    63 = 0001			POKEYMAX_PSGFREQ_1MHZ = %00000001
    64 = 0002			POKEYMAX_PSGFREQ_BASE = %00000010
    65 = 0000			POKEYMAX_PSGSTEREO_MONO = %00000000
    66 = 0004			POKEYMAX_PSGSTEREO_ABC = %00000100
    67 = 0008			POKEYMAX_PSGSTEREO_ACB = %00001000
    68 = 000C			POKEYMAX_PSGSTEREO_CHIP = %00001100
    69 = 0000			POKEYMAX_PSGENV_32 = %00000000
    70 = 0010			POKEYMAX_PSGENV_16 = %00010000
    71 = 0000			POKEYMAX_PSGVOL_LOG = %00000000
    72 = 0060			POKEYMAX_PSGVOL_LINEAR = %01100000
    73
    74 = 0006			POKEYMAX_SIDMODE = $06
    75 = 0000			POKEYMAX_SID1FILTER_8580 = %00000000
    76 = 0001			POKEYMAX_SID1FILTER_6581 = %00000001
    77 = 0000			POKEYMAX_SID1DIGIFIX_OFF = %00000000
    78 = 0002			POKEYMAX_SID1DIGIFIX_ON = %00000010
    79 = 0000			POKEYMAX_SID2FILTER_8580 = %00000000
    80 = 0010			POKEYMAX_SID2FILTER_6581 = %00010000
    81 = 0000			POKEYMAX_SID2DIGIFIX_OFF = %00000000
    82 = 0020			POKEYMAX_SID2DIGIFIX_ON = %00100000
    83
    84 = 0007			POKEYMAX_RESTRICT = $07
    85 				;POKEYMAX_POKEY_SINGLE = %00000000
    86 				;POKEYMAX_POKEY_STEREO = %00000001
    87 				;POKEYMAX_POKEY_QUAD = %00000010
    88 = 0004			POKEYMAX_SID_ENABLE = %00000100
    89 = 0008			POKEYMAX_PSG_ENABLE = %00001000
    90 = 0010			POKEYMAX_COVOXSAMPLE_ENABLE = %00010000
    91
    92 = 000C			POKEYMAX_ID = $0C
    93 = 0001			POKEYMAX_INSTALLED = %00000001
    94
    95 = 000C			POKEYMAX_CONFIG = $0C
    96 = 0000			POKEYMAX_CFGDIS = %00000000
    97 = 003F			POKEYMAX_CFGEN = %00111111
    98
    99 = 000B			POKEYMAX_FLASHOP = $0B
   100 = 0000			POKEYMAX_FLASH_WRITE = %00000000
   101 = 0001			POKEYMAX_FLASH_READ = %00000001
   102 = 0000			POKEYMAX_FLASH_REQ8 = %00000000
   103 = 0002			POKEYMAX_FLASH_REQ32 = %00000010
   104 = 0000			POKEYMAX_FLASH_ACCESS_DATA = %00000000
   105 = 0004			POKEYMAX_FLASH_ACCESS_CONFIG = %00000100
   106 = 0038			POKEYMAX_FLASH_A14 = %00111000
   107
   108 = 000D			POKEYMAX_FLASHADL = $0D
   109 = 00FC			POKEYMAX_FLASH_A0 = %11111100
   110 = 0003			POKEYMAX_FLASH_WIN = %00000011
   111 = 000E			POKEYMAX_FLASHADH = $0E
   112 = 000F			POKEYMAX_FLASHDAT = $0F
   113
   114 					org $2000
   115
   116 				; Detect PokeyMAX device
   117 				detectpokeymax:
   118 FFFF> 2000-2067> AD 0C +         lda POKEYMAX_BASE+POKEYMAX_ID
   119 2003 C9 01		        cmp #POKEYMAX_INSTALLED
   120 2005 D0 46		        bne ?no
   121
   122 2007 A9 3F		        lda #%00111111          ;setup configuration bank in $D21x
   123 2009 8D 1C D2		        sta POKEYMAX_CONFIG_BASE+POKEYMAX_CONFIG
   124
   125 200C AD 11 D2		        lda POKEYMAX_CONFIG_BASE+POKEYMAX_CAPABILITY
   126 200F 29 04		        and #POKEYMAX_SID_PRESENT
   127 2011 F0 02		        seq
   128 2013 A9 03		        lda #%00000011
   129 2015 8D 2C 20		        sta pokeymaxdetected
   130
   131 2018 A2 07		        ldx #8-1
   132 201A 8E 14 D2		?loop   stx POKEYMAX_CONFIG_BASE+POKEYMAX_VERSIONLOC
   133 201D AD 14 D2		        lda POKEYMAX_CONFIG_BASE+POKEYMAX_VERSION
   134 2020 9D 68 20		        sta pokeymaxver,x
   135 2023 CA			        dex
   136 2024 10 F4		        bpl ?loop
   137
   138 2026 A9 00		        lda #%00000000          ;disable configuration bank in $D21x
   139 2028 8D 1C D2		        sta POKEYMAX_CONFIG_BASE+POKEYMAX_CONFIG
   140
   141 202B A9 00		        lda pokeymaxdetected: #$00
   142 202D F0 1E		        beq ?no
   143
   144 202F 20 70 20		        jsr PRINTF
   145 2032 50 4F 4B 45 59 4D +         .byte 'POKEYMAX %8s detected.',EOL
   146 2049 00			        .byte 0
   147 204A 68 20		        .word pokeymaxver
   148 204C 60			        rts
   149
   150 204D 20 70 20		?no     jsr PRINTF
   151 2050 4E 6F 20 50 4F 4B +         .byte 'No POKEYMAX detected.',EOL
   152 2066 00			        .byte 0
   153 2067 60			        rts
   154
   155 				; PokeyMAX version buffer
   156 = 2068			pokeymaxver .ds 8
   157
   158
   159 2070-2127> 18 68 69 01 + 	.link 'printf.obx'
